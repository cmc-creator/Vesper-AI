name: Deployment Configuration Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate-deployment:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Validate deployment configuration
      run: |
        python3 validate-deployment.py
    
    - name: Check deployment files
      run: |
        echo "Checking deployment documentation..."
        test -f DEPLOY.md || (echo "âŒ DEPLOY.md missing" && exit 1)
        test -f QUICKSTART-DEPLOY.md || (echo "âŒ QUICKSTART-DEPLOY.md missing" && exit 1)
        echo "âœ… Deployment documentation found"
    
    - name: Validate Railway config
      run: |
        echo "Validating railway.json..."
        python3 -m json.tool railway.json > /dev/null
        echo "âœ… railway.json is valid JSON"
    
    - name: Validate Vercel config
      run: |
        echo "Validating vercel.json..."
        python3 -m json.tool vercel.json > /dev/null
        echo "âœ… vercel.json is valid JSON"
    
    - name: Check Python requirements
      run: |
        echo "Checking requirements.txt..."
        test -f requirements.txt || (echo "âŒ requirements.txt missing" && exit 1)
        grep -q "fastapi" requirements.txt || (echo "âŒ fastapi not in requirements.txt" && exit 1)
        grep -q "uvicorn" requirements.txt || (echo "âŒ uvicorn not in requirements.txt" && exit 1)
        echo "âœ… Backend requirements OK"
    
    - name: Summary
      if: success()
      run: |
        echo ""
        echo "======================================"
        echo "âœ… All deployment checks passed!"
        echo "ğŸš€ Ready for deployment"
        echo "======================================"
